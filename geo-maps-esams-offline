generic-map => {
    geoip2_db => GeoIP2-City.mmdb
    datacenters => [codfw, eqiad, ulsfo, eqsin, esams, bh, ref]
    map => {
        # use ISO 3166-2 official names
        AF => [eqiad, codfw, ulsfo, eqsin],
        AS => {
            default => [eqsin, ulsfo, codfw, eqiad],
            AE => [eqiad, codfw, ulsfo, eqsin], # United Arab Emirates
            AF => [eqiad, codfw, ulsfo, eqsin], # Afghanistan
            AM => [eqiad, codfw, ulsfo, eqsin], # Armenia
            AP => [eqsin, ulsfo, codfw, eqiad], # Asia-Pacific region (misc)
            AZ => [eqiad, codfw, ulsfo, eqsin], # Azerbaijan
            BD => [eqsin, ulsfo, codfw, eqiad], # Bangladesh
            BH => [eqiad, codfw, ulsfo, eqsin], # Bahrain
            BN => [eqsin, ulsfo, codfw, eqiad], # Brunei Darussalam
            BT => [eqsin, ulsfo, codfw, eqiad], # Bhutan
            CC => [eqsin, ulsfo, codfw, eqiad], # Cocos (Keeling) Islands
            CN => [ulsfo, codfw, eqiad, eqsin], # China
            CX => [eqsin, ulsfo, codfw, eqiad], # Christmas Island
            CY => [eqiad, codfw, ulsfo, eqsin], # Cyprus
            GE => [eqiad, codfw, ulsfo, eqsin], # Georgia
            HK => [eqsin, ulsfo, codfw, eqiad], # Hong Kong
            ID => [eqsin, ulsfo, codfw, eqiad], # Indonesia
            IL => [eqiad, codfw, ulsfo, eqsin], # Israel
            IN => [eqsin, eqiad, codfw, ulsfo], # India
            IO => [eqiad, codfw, ulsfo, eqsin], # British Indian Ocean Territory
            IQ => [eqiad, codfw, ulsfo, eqsin], # Iraq
            IR => [eqiad, codfw, ulsfo, eqsin], # Iran (Islamic Republic of)
            JO => [eqiad, codfw, ulsfo, eqsin], # Jordan
            JP => [eqsin, ulsfo, codfw, eqiad], # Japan
            KG => [eqiad, codfw, ulsfo, eqsin], # Kyrgyzstan
            KH => [eqsin, ulsfo, codfw, eqiad], # Cambodia
            KP => [ulsfo, codfw, eqiad, eqsin], # Korea, Democratic People's Republic of
            KR => [eqsin, ulsfo, codfw, eqiad], # Korea, Republic of
            KW => [eqiad, codfw, ulsfo, eqsin], # Kuwait
            KZ => [eqiad, codfw, ulsfo, eqsin], # Kazakhstan
            LA => [eqsin, ulsfo, codfw, eqiad], # Lao People's Democratic Republic
            LB => [eqiad, codfw, ulsfo, eqsin], # Lebanon
            LK => [eqsin, eqiad, codfw, ulsfo], # Sri Lanka
            MM => [eqsin, ulsfo, codfw, eqiad], # Myanmar
            MN => [eqsin, ulsfo, codfw, eqiad], # Mongolia
            MO => [eqsin, ulsfo, codfw, eqiad], # Macao
            MV => [eqsin, ulsfo, codfw, eqiad], # Maldives
            MY => [eqsin, ulsfo, codfw, eqiad], # Malaysia
            NP => [eqsin, ulsfo, codfw, eqiad], # Nepal
            OM => [eqiad, codfw, ulsfo, eqsin], # Oman
            PH => [eqsin, ulsfo, codfw, eqiad], # Philippines
            PK => [eqsin, eqiad, codfw, ulsfo], # Pakistan
            PS => [eqiad, codfw, ulsfo, eqsin], # Palestine, State of
            QA => [eqiad, codfw, ulsfo, eqsin], # Qatar
            SA => [eqiad, codfw, ulsfo, eqsin], # Saudi Arabia
            SG => [eqsin, ulsfo, codfw, eqiad], # Singapore
            SY => [eqiad, codfw, ulsfo, eqsin], # Syrian Arab Republic
            TH => [eqsin, ulsfo, codfw, eqiad], # Thailand
            TJ => [eqiad, codfw, ulsfo, eqsin], # Tajikistan
            TL => [eqsin, ulsfo, codfw, eqiad], # Timor-Leste
            TM => [eqiad, codfw, ulsfo, eqsin], # Turkmenistan
            TR => [eqiad, codfw, ulsfo, eqsin], # Turkey
            TW => [eqsin, ulsfo, codfw, eqiad], # Taiwan
            UZ => [eqiad, codfw, ulsfo, eqsin], # Uzbekistan
            VN => [eqsin, ulsfo, codfw, eqiad], # Viet Nam
            YE => [eqiad, codfw, ulsfo, eqsin], # Yemen
        },
        EU => {
            default => [eqiad, codfw, ulsfo, eqsin],
            AD => [eqiad, codfw, ulsfo, eqsin], # Andorra
            AL => [eqiad, codfw, ulsfo, eqsin], # Albania
            AT => [eqiad, codfw, ulsfo, eqsin], # Austria
            AX => [eqiad, codfw, ulsfo, eqsin], # Aland Islands
            BA => [eqiad, codfw, ulsfo, eqsin], # Bosnia and Herzegowina
            BE => [eqiad, codfw, ulsfo, eqsin], # Belgium
            BG => [eqiad, codfw, ulsfo, eqsin], # Bulgaria
            BY => [eqiad, codfw, ulsfo, eqsin], # Belarus
            CH => [eqiad, codfw, ulsfo, eqsin], # Switzerland
            CZ => [eqiad, codfw, ulsfo, eqsin], # Czech Republic
            DE => [eqiad, codfw, ulsfo, eqsin], # Germany
            DK => [eqiad, codfw, ulsfo, eqsin], # Denmark
            EE => [eqiad, codfw, ulsfo, eqsin], # Estonia
            ES => [eqiad, codfw, ulsfo, eqsin], # Spain
            EU => [eqiad, codfw, ulsfo, eqsin], # Europe region (misc)
            FI => [eqiad, codfw, ulsfo, eqsin], # Finland
            FO => [eqiad, codfw, ulsfo, eqsin], # Faroe Islands
            FR => [eqiad, codfw, ulsfo, eqsin], # France
            GB => [eqiad, codfw, ulsfo, eqsin], # United Kingdom
            GG => [eqiad, codfw, ulsfo, eqsin], # Guernsey
            GI => [eqiad, codfw, ulsfo, eqsin], # Gibraltar
            GR => [eqiad, codfw, ulsfo, eqsin], # Greece
            HR => [eqiad, codfw, ulsfo, eqsin], # Croatia (local name Hrvatska)
            HU => [eqiad, codfw, ulsfo, eqsin], # Hungary
            IE => [eqiad, codfw, ulsfo, eqsin], # Ireland
            IM => [eqiad, codfw, ulsfo, eqsin], # Isle of Man
            IS => [eqiad, codfw, ulsfo, eqsin], # Iceland
            IT => [codfw, ulsfo, eqiad, eqsin], # Italy  # temporarily redirected to trade off availability for latency
            JE => [eqiad, codfw, ulsfo, eqsin], # Jersey
            LI => [eqiad, codfw, ulsfo, eqsin], # Liechtenstein
            LT => [eqiad, codfw, ulsfo, eqsin], # Lithuania
            LU => [eqiad, codfw, ulsfo, eqsin], # Luxembourg
            LV => [eqiad, codfw, ulsfo, eqsin], # Latvia
            MC => [eqiad, codfw, ulsfo, eqsin], # Monaco
            MD => [eqiad, codfw, ulsfo, eqsin], # Moldova, Republic of
            ME => [eqiad, codfw, ulsfo, eqsin], # Montenegro
            MK => [eqiad, codfw, ulsfo, eqsin], # Macedonia, the Former Yugoslav Republic of
            MT => [eqiad, codfw, ulsfo, eqsin], # Malta
            NL => [eqiad, codfw, ulsfo, eqsin], # Netherlands
            NO => [eqiad, codfw, ulsfo, eqsin], # Norway
            PL => [eqiad, codfw, ulsfo, eqsin], # Poland
            PT => [eqiad, codfw, ulsfo, eqsin], # Portugal
            RO => [eqiad, codfw, ulsfo, eqsin], # Romania
            RS => [eqiad, codfw, ulsfo, eqsin], # Serbia
            RU => [eqiad, codfw, ulsfo, eqsin], # Russian Federation
            SE => [eqiad, codfw, ulsfo, eqsin], # Sweden
            SI => [eqiad, codfw, ulsfo, eqsin], # Slovenia
            SJ => [eqiad, codfw, ulsfo, eqsin], # Svalbard and Jan Mayen Islands
            SK => [eqiad, codfw, ulsfo, eqsin], # Slovakia
            SM => [eqiad, codfw, ulsfo, eqsin], # San Marino
            UA => [eqiad, codfw, ulsfo, eqsin], # Ukraine
            VA => [eqiad, codfw, ulsfo, eqsin], # Holy See (Vatican City State)
        },
        NA => {
            US => { # United States of America
                AK => [ulsfo, codfw, eqiad, eqsin], # Alaska
                AL => [codfw, eqiad, ulsfo, eqsin], # Alabama
                AR => [codfw, eqiad, ulsfo, eqsin], # Arkansas
                AZ => [ulsfo, codfw, eqiad, eqsin], # Arizona
                CA => [ulsfo, codfw, eqiad, eqsin], # California
                CO => [ulsfo, codfw, eqiad, eqsin], # Colorado
                CT => [codfw, eqiad, ulsfo, eqsin], # Connecticut
                DC => [codfw, eqiad, ulsfo, eqsin], # District of Columbia
                DE => [codfw, eqiad, ulsfo, eqsin], # Delaware
                FL => [codfw, eqiad, ulsfo, eqsin], # Florida
                GA => [codfw, eqiad, ulsfo, eqsin], # Georgia
                HI => [ulsfo, codfw, eqiad, eqsin], # Hawaii
                IA => [ulsfo, codfw, eqiad, eqsin], # Iowa
                ID => [ulsfo, codfw, eqiad, eqsin], # Idaho
                IL => [codfw, eqiad, ulsfo, eqsin], # Illinois
                IN => [codfw, eqiad, ulsfo, eqsin], # Indiana
                KS => [ulsfo, codfw, eqiad, eqsin], # Kansas
                KY => [codfw, eqiad, ulsfo, eqsin], # Kentucky
                LA => [codfw, eqiad, ulsfo, eqsin], # Louisiana
                MA => [codfw, eqiad, ulsfo, eqsin], # Massachusetts
                MD => [codfw, eqiad, ulsfo, eqsin], # Maryland
                ME => [codfw, eqiad, ulsfo, eqsin], # Maine
                MI => [codfw, eqiad, ulsfo, eqsin], # Michigan
                MN => [ulsfo, codfw, eqiad, eqsin], # Minnesota
                MO => [codfw, eqiad, ulsfo, eqsin], # Missouri
                MS => [codfw, eqiad, ulsfo, eqsin], # Mississippi
                MT => [ulsfo, codfw, eqiad, eqsin], # Montana
                NC => [codfw, eqiad, ulsfo, eqsin], # North Carolina
                ND => [ulsfo, codfw, eqiad, eqsin], # North Dakota
                NE => [ulsfo, codfw, eqiad, eqsin], # Nebraska
                NH => [codfw, eqiad, ulsfo, eqsin], # New Hampshire
                NJ => [codfw, eqiad, ulsfo, eqsin], # New Jersey
                NM => [ulsfo, codfw, eqiad, eqsin], # New Mexico
                NV => [ulsfo, codfw, eqiad, eqsin], # Nevada
                NY => [codfw, eqiad, ulsfo, eqsin], # New York
                OH => [codfw, eqiad, ulsfo, eqsin], # Ohio
                OK => [codfw, eqiad, ulsfo, eqsin], # Oklahoma
                OR => [ulsfo, codfw, eqiad, eqsin], # Oregon
                PA => [codfw, eqiad, ulsfo, eqsin], # Pennsylvania
                RI => [codfw, eqiad, ulsfo, eqsin], # Rhode Island
                SC => [codfw, eqiad, ulsfo, eqsin], # South Carolina
                SD => [ulsfo, codfw, eqiad, eqsin], # South Dakota
                TN => [codfw, eqiad, ulsfo, eqsin], # Tennessee
                TX => [codfw, eqiad, ulsfo, eqsin], # Texas
                UT => [ulsfo, codfw, eqiad, eqsin], # Utah
                VA => [codfw, eqiad, ulsfo, eqsin], # Virginia
                VT => [codfw, eqiad, ulsfo, eqsin], # Vermont
                WA => [ulsfo, codfw, eqiad, eqsin], # Washington
                WI => [codfw, eqiad, ulsfo, eqsin], # Wisconsin
                WV => [codfw, eqiad, ulsfo, eqsin], # West Virginia
                WY => [ulsfo, codfw, eqiad, eqsin], # Wyoming
            },
            CA => { # Canada
                AB => [ulsfo, codfw, eqiad, eqsin], # Alberta
                BC => [ulsfo, codfw, eqiad, eqsin], # British Columbia
                MB => [ulsfo, codfw, eqiad, eqsin], # Manitoba
                NB => [codfw, eqiad, ulsfo, eqsin], # New Brunswick
                NL => [codfw, eqiad, ulsfo, eqsin], # Newfoundland
                NS => [codfw, eqiad, ulsfo, eqsin], # Nova Scotia
                NT => [ulsfo, codfw, eqiad, eqsin], # Northwest Territories
                NU => [ulsfo, codfw, eqiad, eqsin], # Nunavut
                ON => [codfw, eqiad, ulsfo, eqsin], # Ontario
                PE => [codfw, eqiad, ulsfo, eqsin], # Prince Edward Island
                QC => [codfw, eqiad, ulsfo, eqsin], # Quebec
                SK => [ulsfo, codfw, eqiad, eqsin], # Saskatchewan
                YT => [ulsfo, codfw, eqiad, eqsin], # Yukon Territory
            },
            MX => [codfw, eqiad, ulsfo, eqsin], # Mexico
        },
        OC => {
            default => [eqsin, ulsfo, codfw, eqiad],
            AS => [ulsfo, eqsin, codfw, eqiad], # American Samoa
            AU => [eqsin, ulsfo, codfw, eqiad], # Australia
            CK => [ulsfo, eqsin, codfw, eqiad], # Cook Islands
            FJ => [ulsfo, eqsin, codfw, eqiad], # Fiji
            FM => [eqsin, ulsfo, codfw, eqiad], # Micronesia, Federated States of
            GU => [eqsin, ulsfo, codfw, eqiad], # Guam
            KI => [eqsin, ulsfo, codfw, eqiad], # Kiribati
            MH => [eqsin, ulsfo, codfw, eqiad], # Marshall Islands
            MP => [eqsin, ulsfo, codfw, eqiad], # Northern Mariana Islands
            NC => [eqsin, ulsfo, codfw, eqiad], # New Caledonia
            NF => [ulsfo, eqsin, codfw, eqiad], # Norfolk Island
            NR => [eqsin, ulsfo, codfw, eqiad], # Nauru
            NU => [ulsfo, eqsin, codfw, eqiad], # Niue
            NZ => [ulsfo, eqsin, codfw, eqiad], # New Zealand
            PF => [ulsfo, eqsin, codfw, eqiad], # French Polynesia
            PG => [ulsfo, eqsin, codfw, eqiad], # Papua New Guinea
            PN => [ulsfo, eqsin, codfw, eqiad], # Pitcairn
            PW => [eqsin, ulsfo, codfw, eqiad], # Palau
            SB => [ulsfo, eqsin, codfw, eqiad], # Solomon Islands
            TK => [ulsfo, eqsin, codfw, eqiad], # Tokelau
            TO => [eqsin, ulsfo, codfw, eqiad], # Tonga
            TV => [eqsin, ulsfo, codfw, eqiad], # Tuvalu
            UM => [eqsin, ulsfo, codfw, eqiad], # United States Minor Outlying Islands
            VU => [ulsfo, eqsin, codfw, eqiad], # Vanuatu
            WF => [ulsfo, eqsin, codfw, eqiad], # Wallis and Futuna
            WS => [ulsfo, eqsin, codfw, eqiad], # Samoa
        },
        default => [codfw, eqiad, ulsfo, eqsin],
    },
    nets = {
        # Wikimedia address space
        208.80.152.0/23    => [codfw, eqiad, ulsfo, eqsin], # codfw
        208.80.154.0/23    => [eqiad, codfw, ulsfo, eqsin], # eqiad
        91.198.174.0/24    => [eqiad, codfw, ulsfo, eqsin], # esams
        185.15.56.0/24     => [eqiad, codfw, ulsfo, eqsin], # cloud-eqiad
        185.15.57.0/29     => [codfw, eqiad, ulsfo, eqsin], # cloud-codfw1dev
        198.35.26.0/23     => [ulsfo, codfw, eqiad, eqsin], # ulsfo
        103.102.166.0/24   => [eqsin, codfw, eqiad, ulsfo], # eqsin
        2620:0:860::/48    => [codfw, eqiad, ulsfo, eqsin], # codfw
        2620:0:861::/48    => [eqiad, codfw, ulsfo, eqsin], # eqiad
        2620:0:862::/48    => [eqiad, codfw, ulsfo, eqsin], # esams
        2620:0:863::/48    => [ulsfo, codfw, eqiad, eqsin], # ulsfo
        2001:df2:e500::/48 => [eqsin, codfw, eqiad, ulsfo], # eqsin
        198.73.209.0/24    => [ulsfo, codfw, eqiad, eqsin], # WMF OIT
        2620:62:c000::/48  => [ulsfo, codfw, eqiad, eqsin], # WMF OIT
        # Wikimedia 10/8 private space
        10.2.1.0/24        => [codfw, eqiad, ulsfo, eqsin], # codfw LVS
        10.2.2.0/24        => [eqiad, codfw, ulsfo, eqsin], # eqiad LVS
        10.2.3.0/24        => [eqiad, codfw, ulsfo, eqsin], # esams LVS
        10.2.4.0/24        => [ulsfo, codfw, eqiad, eqsin], # ulsfo LVS
        10.2.5.0/24        => [eqsin, codfw, eqiad, ulsfo], # eqsin LVS
        10.20.0.0/23       => [eqiad, codfw, ulsfo, eqsin], # esams private/mgmt
        10.64.0.0/12       => [eqiad, codfw, ulsfo, eqsin], # eqiad private/mgmt
        10.128.0.0/16      => [ulsfo, codfw, eqiad, eqsin], # ulsfo private/mgmt
        10.132.0.0/16      => [eqsin, codfw, eqiad, ulsfo], # eqsin private/mgmt
        10.192.0.0/12      => [codfw, eqiad, ulsfo, eqsin], # codfw private/mgmt
        # Wikimedia 172.16/12 private space
        172.16.0.0/21      => [eqiad, codfw, ulsfo, eqsin], # cloud-instances2-b-eqiad
        172.16.128.0/24    => [codfw, eqiad, ulsfo, eqsin], # cloud-instances2-b-codfw
        # Level3's DNS clusters
        192.221.132.0/22   => [codfw, eqiad, ulsfo, eqsin], # Atlanta
        192.221.136.0/22   => [codfw, eqiad, ulsfo, eqsin], # Chicago
        192.221.140.0/22   => [codfw, eqiad, ulsfo, eqsin], # Dallas
        192.221.148.0/22   => [ulsfo, codfw, eqiad, eqsin], # Los Angeles
        192.221.156.0/22   => [codfw, eqiad, ulsfo, eqsin], # New York
        192.221.160.0/22   => [ulsfo, codfw, eqiad, eqsin], # San Jose
        192.221.164.0/22   => [codfw, eqiad, ulsfo, eqsin], # Washington, DC
        8.0.4.0/22         => [codfw, eqiad, ulsfo, eqsin], # Atlanta
        8.0.8.0/22         => [codfw, eqiad, ulsfo, eqsin], # Chicago
        8.0.12.0/22        => [codfw, eqiad, ulsfo, eqsin], # Dallas
        8.0.20.0/22        => [ulsfo, codfw, eqiad, eqsin], # Los Angeles
        8.0.28.0/22        => [codfw, eqiad, ulsfo, eqsin], # New York
        8.0.32.0/22        => [ulsfo, codfw, eqiad, eqsin], # San Jose
        8.0.36.0/22        => [codfw, eqiad, ulsfo, eqsin], # Washington, DC
        # AT&T's DNS clusters (incomplete)
        151.164.0.0/16     => [ulsfo, codfw, eqiad, eqsin], # West Coast?
        12.121.112.0/22    => [ulsfo, codfw, eqiad, eqsin], # West Coast?
        # Facebook prefixes learned in ulsfo
        31.13.24.0/21      => [codfw, eqiad, ulsfo, eqsin],
        31.13.64.0/18      => [codfw, eqiad, ulsfo, eqsin],
        45.64.40.0/22      => [codfw, eqiad, ulsfo, eqsin],
        66.220.144.0/20    => [codfw, eqiad, ulsfo, eqsin],
        69.63.176.0/20     => [codfw, eqiad, ulsfo, eqsin],
        69.171.224.0/19    => [codfw, eqiad, ulsfo, eqsin],
        74.119.76.0/22     => [codfw, eqiad, ulsfo, eqsin],
        103.4.96.0/22      => [codfw, eqiad, ulsfo, eqsin],
        157.240.0.0/17     => [codfw, eqiad, ulsfo, eqsin],
        173.252.64.0/19    => [codfw, eqiad, ulsfo, eqsin],
        173.252.96.0/19    => [codfw, eqiad, ulsfo, eqsin],
        179.60.192.0/22    => [codfw, eqiad, ulsfo, eqsin],
        185.60.216.0/22    => [codfw, eqiad, ulsfo, eqsin],
        204.15.20.0/22     => [codfw, eqiad, ulsfo, eqsin],
        2620:0:1c00::/40   => [codfw, eqiad, ulsfo, eqsin],
        2620:0:1cff::/48   => [codfw, eqiad, ulsfo, eqsin],
        2a03:2880::/32     => [codfw, eqiad, ulsfo, eqsin],
        # Wikia's space in VA
        74.120.189.0/24    => [codfw, eqiad, ulsfo, eqsin],
    },
}
